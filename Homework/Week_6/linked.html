<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Linked views</title>

    <!-- Import D3 V5 -->
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script>
      d3v5 = d3;
      window.d3 = null;
    </script>

    <!-- Import D3 V3 and TopoJSON -->
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.9/topojson.min.js"></script>
    <script src="datamaps.world.min.js"></script>
    <script src="toCountryCode.js"></script>
    <script>
      d3v3 = d3;
      window.d3 = null;

      // Test if it worked
      console.log('v3', d3v3.version);
      console.log('v5', d3v5.version);
    </script>
    <div id="container" style="position: relative; width: 800px; height: 600px;"></div>
    <script>
    d3v5.json("data.json").then(function(datas) {

      // Make a list with objects
      all_countries = {}
      for(var i = 0; i < 2196; i++){
        country = {}
        if(datas["fact"][i]["dims"]["SEX"] == "Both sexes" && datas["fact"][i]["dims"]["YEAR"] == 2016){
          value = datas["fact"][i]["Value"];
          if(value < 10){
            fillKey = "LOWER10";
          }
          else if (value > 10 && value < 20){
            fillKey = "TENT20";
          }
          else if(value > 20 && value < 30){
            fillKey = "TWENT30";
          }
          else if(value > 30){
            fillKey = "THIRM";
          }
          country["Value"] = datas["fact"][i]["Value"];
          country["fillKey"] = fillKey;
          code = toCountryCode(datas["fact"][i]["dims"]["COUNTRY"]);
          all_countries[code] = country;
        }
      }

      var map = new Datamap({
          element: document.getElementById('container'),
          fills: {
              LOWER10: '#cbc9e2',
              TENT20: '#9e9ac8',
              TWENT30: '#756bb1',
              THIRM: '#54278f',
              defaultFill: '#f2f0f7'
          },
          data:
            all_countries,
          geographyConfig: {
            highlightBorderColor: '#bada55',
            popupTemplate: function(geography, data) {
              return '<div class="hoverinfo">' + geography.properties.name +
              'Value:' +  all_countries[(geography.id)]["Value"] + ' '
            },
            highlightBorderWidth: 3
          },

    });
        // Draw a legend for this map
        map.legend();

    // Make a pie chart


    });
    </script>

    <!-- REST OF IMPORTS HERE -->

  </head>
  <body>

    <!-- CONTENT OF PAGE HERE -->

  </body>
</html>
